webpackHotUpdate("background",{

/***/ "./src/js/background.js":
/*!******************************!*\
  !*** ./src/js/background.js ***!
  \******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/* global chrome*/\r\nlet video_url;//create to change the url of video snippet by ZZL\r\nlet behaviorTypes = [\"copy\", \"highlight\", \"video_snippet\", \"stay\", \"screenshot\"];\r\n//The characters that have associated meanings in xml of suggestions that\r\n//need to be replaced. The replacement characters are contained as values\r\n//to the keys.\r\nlet xmlChars = {\"&\": \"&amp;\"};\r\n\r\n__webpack_require__(/*! downloadjs */ \"./node_modules/downloadjs/download.js\");\r\n\r\nfunction isValidUrl(text) {\r\n    const valid = /((https?):\\/\\/)?(([w|W]{3}\\.)+)?[a-zA-Z0-9\\-\\.]{3,}\\.[a-zA-Z]{2,}(\\.[a-zA-Z]{2,})?/;\r\n    return valid.test(text);\r\n}\r\n\r\n\r\nfunction getRootUrl(rUrl){\r\n    if(rUrl.includes(\"&feature=youtu.be&t=\")){\r\n        rUrl=rUrl.split(\"&feature=youtu.be&t=\")[0];\r\n    }\r\n\r\n    if(rUrl.includes(\"#\")){\r\n        rUrl=rUrl.split(\"#\")[0];\r\n    }\r\n    return rUrl;\r\n}\r\n/**\r\n * A list of suggestions with common fields \"url\", \"title\", and \"query\". Each\r\n * suggestion corresponds to one past behavior of the user that is prompted by\r\n * the present text input given by the user in the omnibox.\r\n *\r\n * The matching mechanism is defined in the js/background.behaviorMatchesInput\r\n * method, which offers specific matching other than that of title and past\r\n * queries.\r\n *\r\n * Once a behavior matches the current input, js/background.storeSuggestionSnippet\r\n * function will be invoked to properly store this suggestion. A prototype holder\r\n * that contains the basic entries--url, title, query--will be passed in as a\r\n * parameter in case this information is necessary for specific storage. The storage\r\n * of this particular suggestion-behavior must also fill the \"content\" field of\r\n * the snippet. The processing is done by the modification of the passed in\r\n * prototype snippet, as aforementioned.\r\n *\r\n * Succeeding this, the suggestion snippet, the holder of the relevant information\r\n * of the past behavior to be prompted as a suggestion in the omnibox is stored\r\n * in this container, which will modified each time the input changes.\r\n *\r\n * As the selection of any suggestion, or in general the ascertainment of an\r\n * input in the omnibox must supercede some change in input, which triggers the\r\n * proper processing and population of this holder, all the behaviors that can\r\n * elicit a special direction, i.e. to a specific site, is properly stored in\r\n * this holder before js/background.acceptInput is invoked, which checks if\r\n * the input matches any suggestion in this container.\r\n */\r\nlet suggestionHolder;\r\nchrome.omnibox.onInputChanged.addListener(omniboxHandler);\r\nchrome.omnibox.onInputEntered.addListener(acceptInput);\r\nchrome.runtime.onMessage.addListener(handleMessage);\r\nchrome.runtime.onInstalled.addListener(function () {\r\n    chrome.storage.local.clear(function () {\r\n        const error = chrome.runtime.lastError;\r\n        if (error) {\r\n            console.error(error);\r\n        }\r\n    });\r\n});\r\n\r\n\r\n// When a tab just got created.\r\nchrome.tabs.onCreated.addListener(function(tab){\r\n    let toSave = {};\r\n    toSave[tab.id.toString()] = [];\r\n    console.log(\"initializing .. for tab \" + tab.id.toString());\r\n    chrome.storage.local.set(toSave);\r\n});\r\n\r\n/**\r\n * When there is a changed url for some tab,\r\n * 1) fetch the the original query words for the url, assuming the url is redirected\r\n * from a previous search result page in the same tab\r\n * 2) save the url visit record - if no visit in the past, create a entry, if there is, update the visit time\r\n * 3) save the query to the record.\r\n * 4ï¼‰let the content script know this url change, to update UI (draw markers, highlight texts, scroll, etc.)\r\n * 5) save this url history to tab.\r\n */\r\nchrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {\r\n    let tabUrl = getRootUrl(tab.url);\r\n    if (changeInfo.status === \"complete\" && isValidUrl(tabUrl)){\r\n        console.log(\"new url detected:\" + tabUrl +\" for tab \" + tabId);\r\n        let query = null;\r\n        //Look up url history for the current tab.\r\n        chrome.storage.local.get({[tabId.toString()]:[]}, function (item) {\r\n            let pastUrls = item[tabId.toString()];\r\n            // Fetch query from the url history of the current tab\r\n            if (pastUrls.length !== 0)\r\n            {\r\n                let i = pastUrls.length;\r\n                //Try get the most recent query.\r\n                while(--i>=0)\r\n                {\r\n                    try\r\n                    {\r\n                        //Attempt to extract query.\r\n                        query = extractQueryFromUrl(pastUrls[i]);\r\n                    }\r\n                    catch(exc)\r\n                    {\r\n                        //Skip.\r\n                        continue;\r\n                    }\r\n                    //Query extracted must be a string.\r\n                    if(query !== null && typeof query === \"string\")\r\n                        break;\r\n                }\r\n            }\r\n            //Update the current url to the url's behavior item map, if there isn't\r\n            //one yet, create it.\r\n            chrome.storage.local.get(tabUrl, function (urlEntry) {\r\n                //If this url has not been previously stored.\r\n                //merge the behavior of video and stay\r\n                if(!urlEntry[tabUrl])\r\n                {\r\n\r\n                    console.log(\"Url of this tab has not been previously stored!\", urlEntry);\r\n                    saveUrlInfo(tabUrl, {visit:[{visitTime: new Date(), query: query}],\r\n                        title: tab.title})\r\n                }\r\n                else\r\n                {\r\n                    console.log(\"Url previously visited!\", urlEntry);\r\n                    //The previous behavioral information garnered.\r\n                    let behavior = urlEntry[tabUrl];\r\n                    console.log(\"Behavior \", behavior);\r\n                    let videoSnippet={};\r\n                    let rightPosition=null;\r\n                    if (behavior) {\r\n                        if (behavior[\"video_snippet\"]) {\r\n                            videoSnippet = getMostValuableVideo(behavior[\"video_snippet\"]);\r\n                            console.log(videoSnippet);\r\n                        }\r\n                        if (behavior[\"stay\"]) {\r\n                            rightPosition = selectMostValuableStay(behavior[\"stay\"]);\r\n                            console.log(rightPosition);\r\n                        }\r\n                    }\r\n                    chrome.tabs.sendMessage(tabId, {\r\n                        url: tabUrl,\r\n                        \"type\":\"new_url\",\r\n                        \"video\": videoSnippet,\r\n                        \"position\": rightPosition\r\n                    }, function (response) {});\r\n                    //Add the current time and associated query to this url.\r\n                    let visits = behavior[\"visit\"];\r\n                    visits.push({visitTime: new Date(), query: query});\r\n                    saveUrlInfo(tabUrl, behavior)\r\n                }\r\n            });\r\n            //chrome.tabs.sendMessage(tabId, {url: tab.url}, function(response) {});\r\n            pastUrls.push(tabUrl);\r\n            saveUrlsToTab(pastUrls, tabId);\r\n        });\r\n    }\r\n});\r\n\r\n/**\r\n * Compare if two objects have identical fields and identical corresponding values.\r\n * The field \"time\" is not compared.\r\n * At present, comparing two behaviors is restricted to their actual information,\r\n * so if the difference is only in event_type, like \"copy\" and \"highlight\", while\r\n * their content object is the same, the result of comparison will be true.\r\n * @param obj1\r\n * @param obj2\r\n * @returns {boolean}\r\n */\r\nfunction compare(obj1, obj2)\r\n{\r\n    //Fields of both objects\r\n    let keys1 = Object.keys(obj1);\r\n    let keys2 = Object.keys(obj2);\r\n    //Sort the arrays for comparison.\r\n    keys1.sort();\r\n    keys2.sort();\r\n    console.log(\"keys \", keys1, keys2);\r\n    //If the two objects no not even have the same number of keys.\r\n    if(keys1.length !== keys2.length)\r\n        return false;\r\n    //Compare per field; spare the \"time\" field.\r\n    for(let index in keys1)\r\n    {\r\n        console.log(keys1[index], keys2[index], obj1[keys1[index], obj2[keys2[index]]]);\r\n        //If the field name is not identical.\r\n        if(keys1[index] !== keys2[index])\r\n            return false;\r\n        //If the value is not. Spare \"time\".\r\n        else if(keys1[index] !== \"time\" && obj1[keys1[index]] !== obj2[keys1[index]])\r\n            return false;\r\n    }\r\n    return true;\r\n}\r\n\r\n/**\r\n * Extract query given a url\r\n * TODO: support more url pattern to extract queries\r\n * @param url\r\n * @returns {*} the extracted query\r\n */\r\nfunction extractQueryFromUrl(url){\r\n    if (url.includes(\"google.com\")) {\r\n        const regex = /(?<=q=).*?(?=&)/s;\r\n        if (url.match(regex) !== null) {\r\n            return url.match(regex)[0].replace(/\\+/g, ' ');\r\n        }\r\n    }\r\n    if(url.includes(\".amazon.com\")){\r\n        const regex = /(?<=k=).*?(?=&)/s;\r\n        if (url.match(regex) !== null) {\r\n            return url.match(regex)[0].replace(/\\+/g, ' ');\r\n        }\r\n    }\r\n    if(url.includes(\".yelp.com\")){\r\n        const regex = /(?<=find_desc=).*?(?=&)/s;\r\n        if (url.match(regex) !== null) {\r\n            return url.match(regex)[0].replace(/\\+/g, ' ');\r\n        }\r\n    }\r\n    if(url.includes(\".linkedin.com\")){\r\n        const regex = /(?<=keywords=).*?(?=&)/s;\r\n        if (url.match(regex) !== null) {\r\n            return url.match(regex)[0].replace(/\\+/g, ' ');\r\n        }\r\n    }\r\n    if(url.includes(\".youtube.com\")){\r\n        const regex = /search_query=(.*)/;\r\n        if (url.match(regex)[1]!== null) {\r\n            return url.match(regex)[1];\r\n        }\r\n    }\r\n    if(url.includes(\".github.com\"||false||false||false)){\r\n        const regex = /q=(.*)/;\r\n        if (url.match(regex)[1]!== null) {\r\n            return url.match(regex)[1];\r\n        }\r\n    }\r\n    if(url.includes(\".wikipedia.org\")){\r\n        const regex = /wiki\\/(.*)/;\r\n        if (url.match(regex)[1]!== null) {\r\n            return url.match(regex)[1];\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Initializes or modifies the namespace for an url of its corresponding visit\r\n * information, which is an array of objects with keys \"visitTime\", and \"query\";\r\n * the latter may be null. This method is invoked when a tab is newly loaded.\r\n * The info parameter must be the entire map of behavioral information associated\r\n * with this url.\r\n * @param url The url whose corresponding behavioral information is to be modified.\r\n * @param info The entire map of behavioral information associated.\r\n */\r\nfunction saveUrlInfo(url, info)\r\n{\r\n    chrome.storage.local.set({[url]: info});\r\n}\r\n\r\n/**\r\n * Save a list of url as history for a tab\r\n * TODO: derek - add visit time information for each url.\r\n * @param urls\r\n * @param tabId\r\n */\r\nfunction saveUrlsToTab(urls, tabId){\r\n    console.log(\"save urls to tab \"+ tabId);\r\n    let toSave = {};\r\n    toSave[tabId.toString()] =  urls;\r\n    chrome.storage.local.set(toSave);\r\n}\r\n\r\n/**\r\n *\r\n * @param str\r\n * @param coords\r\n * @param callback\r\n */\r\nfunction cropData(str, coords, callback) {\r\n    let img = new Image();\r\n\r\n    img.onload = function() {\r\n        let canvas = document.createElement('canvas');\r\n        canvas.width = coords.w;\r\n        canvas.height = coords.h;\r\n\r\n        canvas.getContext('2d').drawImage(img, coords.x*window.devicePixelRatio, coords.y*window.devicePixelRatio, coords.w*window.devicePixelRatio, coords.h*window.devicePixelRatio, 0, 0, coords.w, coords.h);\r\n\r\n        callback({dataUri: canvas.toDataURL()});\r\n    };\r\n\r\n    img.src = str;\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param _screenshotObj\r\n */\r\nfunction capture(_screenshotObj) {\r\n    chrome.tabs.captureVisibleTab(null, {format: \"png\"}, function(data) {\r\n\r\n        cropData(data, _screenshotObj.coordinates, function(data) {\r\n            download(data.dataUri, _screenshotObj.filename, \"image/plain\");\r\n        });\r\n    });\r\n}\r\n\r\n\r\n/**\r\n * Update, or add, a behavior item on the given web page. Each url corresponds with\r\n * a map that contains different behavior codes as keys and an array that contains\r\n * all behavioral information of this type of behavior. For certain information, as\r\n * title, which does not really account for a behavior that can occur more than once,\r\n * their corresponding value may be a single value.\r\n * @param url The url associated with this information.\r\n * @param behaviorType The type of behavior, as delineated in the behavior code container.\r\n * @param behavior The actual bundle of behavioral information to be stored.\r\n */\r\nfunction update(url, behaviorType, behavior)\r\n{\r\n    //If no previous storage of behavior exists under this url, result would be {}.\r\n    chrome.storage.local.get(url, function (result)\r\n    {\r\n        // If there are no existing behaviors stored yet to this url,\r\n        // provide a container.\r\n        let existingBehaviors;\r\n        if(!result[url])\r\n            existingBehaviors = {};\r\n        else\r\n            existingBehaviors = result[url];\r\n        //All previous behaviors of this category.\r\n        let bhvs;\r\n        //Whether the current behavior is a duplicate in content of one recorded\r\n        //before.\r\n        let isDuplicate = false;\r\n        // Append the new behavior to the end of the list of this type of behavior\r\n        if(!result[url] || !existingBehaviors[behaviorType])\r\n            existingBehaviors[behaviorType] = [];\r\n        else\r\n        {\r\n            bhvs = existingBehaviors[behaviorType];\r\n            //Check if a duplicate behavior of a different access time is encountered.\r\n            for(let index in bhvs)\r\n            {\r\n                if(compare(bhvs[index], behavior))\r\n                {\r\n                    if(isDuplicate)\r\n                        bhvs[index].time.push(behavior.time[0]);\r\n                    isDuplicate = true;\r\n                }\r\n            }\r\n        }\r\n        bhvs = existingBehaviors[behaviorType];\r\n        if(!isDuplicate)\r\n        //Append this behavior as new behavior if none with the same content\r\n        //is found.\r\n            bhvs.push(behavior);\r\n        //The url-associated behavior record.\r\n        let toSave = {};\r\n        toSave[url] = existingBehaviors;\r\n        console.log(existingBehaviors);\r\n        console.log(\"Behavior Stored \", toSave);\r\n        chrome.storage.local.set(toSave);\r\n    });\r\n}\r\n\r\n/**\r\n * Selecting a most probable stay users would like to revisit\r\n * TODO: @ZZL - Consider stay frequency\r\n * @param array\r\n * @returns {*}\r\n */\r\n//update consider stay frequency\r\nfunction selectMaxPosition(array){\r\n    let maxPosition=0;\r\n    for (let i = 0; i <= array.length - 1; i++) {\r\n        if (array[i].position > maxPosition) {\r\n            maxPosition = array[i].position;\r\n        }\r\n    }\r\n    return maxPosition;\r\n}\r\n//Window maximization about 1000 a page,divide by 500 a part\r\nfunction selectMostValuableStay(array) {\r\n    let sumDuration = [];\r\n    let stayPosition=[];\r\n    let scrollTo;\r\n    let maxDuration=0;\r\n    let k = Math.ceil(selectMaxPosition(array)/ 500);\r\n    for (k; k >=0; k--) {\r\n        sumDuration[k]=0;\r\n        stayPosition[k]=0;\r\n        for (let i = 0; i <= array.length - 1; i++) {\r\n            if (array[i].position > 500 * (k - 1) && array[i].position <= 500 * k) {\r\n                sumDuration[k] = sumDuration[k] + array[i].duration;\r\n                stayPosition[k] = (array[i].position + stayPosition[k]) / 2\r\n            }\r\n        }\r\n    }\r\n    for(let j=0;j<=Math.ceil(selectMaxPosition(array)/ 500);j++){\r\n        if(sumDuration[j]>maxDuration){\r\n            scrollTo=stayPosition[j];\r\n            maxDuration=sumDuration[j];\r\n        }\r\n    }\r\n    return scrollTo;\r\n}\r\n//update above\r\n\r\n\r\nfunction getMostValuableVideo(array) {\r\n    let longestTime=0;\r\n    let valuableSnippet;\r\n    for (let i = 0; i <= array.length - 1; i++) {\r\n        let snippet=array[i].end_time-array[i].start_time;\r\n        if(snippet>longestTime){\r\n            valuableSnippet=array[i];\r\n            longestTime=snippet;\r\n        }\r\n    }\r\n    return valuableSnippet;\r\n}\r\n//get most valuable video snippet's url and value gives to video_url\r\nfunction valuableVideoUrl(vUrl, videoSnippets)\r\n{\r\n    if(!videoSnippets)\r\n    {\r\n        console.log(\"No Video Snippets at this Url: Wrong Passing!\");\r\n        return;\r\n    }\r\n    let videoSnippet = getMostValuableVideo(videoSnippets);\r\n    let uString = '&feature=youtu.be&t=' +Math.floor(videoSnippet.start_time);\r\n    return vUrl.concat(uString);\r\n}\r\n\r\n\r\n\r\n/**\r\n * Handling messages from content script.\r\n * @param request\r\n * @param sender\r\n * @param sendResponse\r\n * @returns {boolean}\r\n */\r\nfunction handleMessage(request, sender, sendResponse)\r\n{\r\n    //Sift the event type from the allowed list of behaviors.\r\n    let etype;\r\n    //Keys for the message, one of them being a behavior type.\r\n    let keys = Object.keys(request);\r\n    for(let index in keys)\r\n        if(behaviorTypes.includes(keys[index])){\r\n            etype = keys[index];\r\n            if (keys[index] === \"screenshot\")\r\n                capture(request.screenshot);\r\n        }\r\n\r\n    //Invalid message if no event type is given.\r\n    if(!etype) {\r\n        console.error(\"No Event Types Given! \", request);\r\n        return false;\r\n    }\r\n\r\n    if (behaviorTypes.includes(etype)) {\r\n        update(request.url, etype, request[etype]);\r\n    }\r\n    return true;\r\n}\r\n\r\n\r\n\r\n/**\r\n *\r\n * @param type\r\n * @param bhv\r\n * @param omniboxInput\r\n * @returns {String} The specific type of behavior the input matches.\r\n */\r\nfunction behaviorMatchesInput(type, bhv, omniboxInput) {\r\n    if(type === \"copy\")\r\n    {\r\n        //If a code segment is encountered.\r\n        if(bhv.is_code)\r\n            if(bhv.text.indexOf(omniboxInput) !== -1)\r\n                return \"code\";\r\n    }\r\n    if (bhv.title.toString().toLowerCase().includes(omniboxInput.toString().toLowerCase())){\r\n        // @Derek: I merge the title matching here to simplify the code. For default value, the\r\n        // subsequent html suggestion shouldn't do anything special, would be great to load the original site logo.\r\n        return \"default\";\r\n    }\r\n}\r\n\r\n\r\n//The snippet that contains the site-general information is passed in as\r\n//the third parameter, which is modified by this method.\r\nfunction storeSuggestionSnippet(bhvType, bhv, snippet)\r\n{\r\n    //The portable data carrier for omnibox suggestion to be returned.\r\n    let suggestBehavior = snippet;\r\n    if(bhvType === \"copy\") {\r\n        if(bhv.is_code) {\r\n            //Store the behavior-specific fields.\r\n            suggestBehavior[\"content\"] = bhv.text;\r\n            suggestBehavior[\"type\"] = \"code\";\r\n        }\r\n    }\r\n    else if(bhvType === \"video_snippet\") {\r\n        suggestBehavior[\"content\"] = suggestBehavior[\"title\"];\r\n        suggestBehavior[\"type\"] = \"video_snippet\";\r\n        suggestBehavior[\"url\"] = bhv;\r\n    }\r\n    //Add common quantities as section_id to the suggestion carrier.\r\n    //These are confined to those contained in the behavior itself, not the url,\r\n    //title, or query, which must be appended in background.omniboxHandler.\r\n    suggestBehavior[\"section_id\"] = bhv.section_id;\r\n}\r\n\r\nfunction makeSuggestionHTML(suggest)\r\n{\r\n    console.log(\"Suggestion Holder\", suggestionHolder);\r\n\r\n    let suggestions = [];\r\n    for(let i=0; i<suggestionHolder.length; i++) {\r\n\r\n        let suggestion = suggestionHolder[i];\r\n        let formattedSuggestion;\r\n        if(suggestion.type === \"code\")\r\n            formattedSuggestion = {\r\n                content: suggestion.content,\r\n                description: (suggestion.query.length===0?\"\":\r\n                    suggestion.query.toString() + \": \") + suggestion.content\r\n            };\r\n        else if(suggestion.type === \"video_snippet\")\r\n            formattedSuggestion =\r\n                {\r\n                    content: suggestion.content,\r\n                    description: (suggestion.query.length===0?\"\":\r\n                        suggestion.query.toString() + \": \") + suggestion.content\r\n                };\r\n\r\n        //Check if xml specific strings are encountered in the description.\r\n        for(let xmlChar in xmlChars)\r\n            if(formattedSuggestion.description.indexOf(xmlChar) !== -1)\r\n                formattedSuggestion.description =\r\n                    formattedSuggestion.description.split(xmlChar).join(xmlChars[xmlChar]);\r\n\r\n        suggestions.push(formattedSuggestion);\r\n    }\r\n    suggest(suggestions);\r\n}\r\n\r\n/**\r\n * Handling text inputs from the omnibox and generate suggestions\r\n *\r\n * For those types of behaviors that have no detailed content for matching, other\r\n * than the general title and the past queries of the site, their checking part\r\n * may be foregone in the background.behaviorMatchesInput method, but should\r\n * instead be recorded in the background.storeSuggestionSnippet method.\r\n * @param omniboxText The current text typed by the user in the omnibox.\r\n * @param suggest A function for populating suggestions.\r\n */\r\n\r\nfunction omniboxHandler(omniboxText, suggest)\r\n{\r\n    chrome.storage.local.get(null,\r\n        //All the behaviors organized by their urls as keys.\r\n        function (bhvItems) {\r\n            //A holder for any kind of previous behavior that may prompt a useful\r\n            //suggestion.\r\n            suggestionHolder = [];\r\n            //Loop through each url and examine if any of its behaviors matches the\r\n            //input given presently in the omnibox by the user.\r\n            for (let url in bhvItems) {\r\n                console.log(\"hey:\" + url);\r\n                //Behaviors contained under this url. All behaviors wished to be\r\n                //processed to prompt a suggestion individually should be\r\n                //included in this container.\r\n                let bhvs = {};\r\n                let bhvItm = bhvItems[url];\r\n                //The previously copied information from this page.\r\n                if (bhvItm.copy)\r\n                    bhvs[\"copy\"] = bhvItm.copy;\r\n\r\n                if(bhvItm.video_snippet) {\r\n                    console.log(\"video snippet\");\r\n                    console.log(valuableVideoUrl(url, bhvItm.video_snippet));\r\n                    //Select the video snippet to direct unto.\r\n                    bhvs[\"video_snippet\"] = ({url: valuableVideoUrl(url, bhvItm.video_snippet)});\r\n                }\r\n\r\n                //Extract the queries and title that may be used for matching.\r\n                //A list of associated query for this code snippet. The queries\r\n                //in this array must match the current omnibox input.\r\n                let queries = [];\r\n                //Check if this url, and hence this behavior, is\r\n                //associated with a query.\r\n                for (let idx in bhvItm.visit) {\r\n                    let visit = bhvItm.visit[idx];\r\n                    if (visit[\"query\"] !== null && query.toString().toLowerCase().includes(omniboxText.toString().toLowerCase()))\r\n                        queries.push(visit[\"query\"]);\r\n                }\r\n\r\n\r\n                for (let each_type in bhvs) {\r\n                    let behaviors = bhvs[each_type];\r\n                    //Determine for each behavior of this type if it matches\r\n                    //the current input given by the user.\r\n                    for (let bhvIndex in behaviors) {\r\n                        let bhv = behaviors[bhvIndex];\r\n                        //The specific type of behavior the input triggers. This\r\n                        //may modify the behavior type stored to one more specific,\r\n                        //like copy to code.\r\n\r\n                        if(behaviorMatchesInput(each_type, bhv, omniboxText)\r\n                            || queries.length !== 0) {\r\n                            console.log(\"Ready to Store!\");\r\n\r\n                            let snippet = {\r\n                                \"title\": bhvItm.title,\r\n                                \"url\": url,\r\n                                \"query\": queries\r\n                            };\r\n\r\n                            //Store this behavior accordingly. First specifically,\r\n                            //then add the common attributes.\r\n                            storeSuggestionSnippet(each_type, bhv, snippet);\r\n\r\n                            //Add this snippet for suggestion.\r\n                            suggestionHolder.push(snippet);\r\n                        }\r\n\r\n                    }\r\n                }\r\n            }\r\n            makeSuggestionHTML(suggest);\r\n        });\r\n}\r\n\r\n/**\r\n *\r\n * @param text\r\n * @param disposition\r\n */\r\nfunction acceptInput(text, disposition) {\r\n    // disposition: \"currentTab\", \"newForegroundTab\", or \"newBackgroundTab\"\r\n    //If previously extracted code segments match the current text, direct to them.\r\n    if (!isValidUrl(text) && !suggestionHolder) {\r\n        return;\r\n    }\r\n    switch (disposition) {\r\n        case \"currentTab\": {\r\n            //Default link using text.\r\n            let link = text;\r\n\r\n            for(let index in suggestionHolder)\r\n            {\r\n                //Snippet of title-bundled copied behavior.\r\n                let snippet = suggestionHolder[index];\r\n                console.log(snippet);\r\n                if(snippet.content.trim() === text)\r\n                {\r\n                    link = snippet.url;\r\n                    link = snippet.url.concat(snippet.section_id?\r\n                        (\"#\"+snippet.section_id):\"\");\r\n                    console.log(\"link \", link);\r\n                    break;\r\n                }\r\n            }\r\n            chrome.tabs.update({url: link});\r\n            break;\r\n        }\r\n        case \"newForegroundTab\": {\r\n            chrome.tabs.create({url: text});\r\n            break;\r\n        }\r\n        case \"newBackgroundTab\": {\r\n            chrome.tabs.create({url: text, active: false});\r\n            break;\r\n        }\r\n    }\r\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvanMvYmFja2dyb3VuZC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9qcy9iYWNrZ3JvdW5kLmpzPzgxMDQiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGNocm9tZSovXHJcbmxldCB2aWRlb191cmw7Ly9jcmVhdGUgdG8gY2hhbmdlIHRoZSB1cmwgb2YgdmlkZW8gc25pcHBldCBieSBaWkxcclxubGV0IGJlaGF2aW9yVHlwZXMgPSBbXCJjb3B5XCIsIFwiaGlnaGxpZ2h0XCIsIFwidmlkZW9fc25pcHBldFwiLCBcInN0YXlcIiwgXCJzY3JlZW5zaG90XCJdO1xyXG4vL1RoZSBjaGFyYWN0ZXJzIHRoYXQgaGF2ZSBhc3NvY2lhdGVkIG1lYW5pbmdzIGluIHhtbCBvZiBzdWdnZXN0aW9ucyB0aGF0XHJcbi8vbmVlZCB0byBiZSByZXBsYWNlZC4gVGhlIHJlcGxhY2VtZW50IGNoYXJhY3RlcnMgYXJlIGNvbnRhaW5lZCBhcyB2YWx1ZXNcclxuLy90byB0aGUga2V5cy5cclxubGV0IHhtbENoYXJzID0ge1wiJlwiOiBcIiZhbXA7XCJ9O1xyXG5cclxucmVxdWlyZShcImRvd25sb2FkanNcIik7XHJcblxyXG5mdW5jdGlvbiBpc1ZhbGlkVXJsKHRleHQpIHtcclxuICAgIGNvbnN0IHZhbGlkID0gLygoaHR0cHM/KTpcXC9cXC8pPygoW3d8V117M31cXC4pKyk/W2EtekEtWjAtOVxcLVxcLl17Myx9XFwuW2EtekEtWl17Mix9KFxcLlthLXpBLVpdezIsfSk/LztcclxuICAgIHJldHVybiB2YWxpZC50ZXN0KHRleHQpO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gZ2V0Um9vdFVybChyVXJsKXtcclxuICAgIGlmKHJVcmwuaW5jbHVkZXMoXCImZmVhdHVyZT15b3V0dS5iZSZ0PVwiKSl7XHJcbiAgICAgICAgclVybD1yVXJsLnNwbGl0KFwiJmZlYXR1cmU9eW91dHUuYmUmdD1cIilbMF07XHJcbiAgICB9XHJcblxyXG4gICAgaWYoclVybC5pbmNsdWRlcyhcIiNcIikpe1xyXG4gICAgICAgIHJVcmw9clVybC5zcGxpdChcIiNcIilbMF07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gclVybDtcclxufVxyXG4vKipcclxuICogQSBsaXN0IG9mIHN1Z2dlc3Rpb25zIHdpdGggY29tbW9uIGZpZWxkcyBcInVybFwiLCBcInRpdGxlXCIsIGFuZCBcInF1ZXJ5XCIuIEVhY2hcclxuICogc3VnZ2VzdGlvbiBjb3JyZXNwb25kcyB0byBvbmUgcGFzdCBiZWhhdmlvciBvZiB0aGUgdXNlciB0aGF0IGlzIHByb21wdGVkIGJ5XHJcbiAqIHRoZSBwcmVzZW50IHRleHQgaW5wdXQgZ2l2ZW4gYnkgdGhlIHVzZXIgaW4gdGhlIG9tbmlib3guXHJcbiAqXHJcbiAqIFRoZSBtYXRjaGluZyBtZWNoYW5pc20gaXMgZGVmaW5lZCBpbiB0aGUganMvYmFja2dyb3VuZC5iZWhhdmlvck1hdGNoZXNJbnB1dFxyXG4gKiBtZXRob2QsIHdoaWNoIG9mZmVycyBzcGVjaWZpYyBtYXRjaGluZyBvdGhlciB0aGFuIHRoYXQgb2YgdGl0bGUgYW5kIHBhc3RcclxuICogcXVlcmllcy5cclxuICpcclxuICogT25jZSBhIGJlaGF2aW9yIG1hdGNoZXMgdGhlIGN1cnJlbnQgaW5wdXQsIGpzL2JhY2tncm91bmQuc3RvcmVTdWdnZXN0aW9uU25pcHBldFxyXG4gKiBmdW5jdGlvbiB3aWxsIGJlIGludm9rZWQgdG8gcHJvcGVybHkgc3RvcmUgdGhpcyBzdWdnZXN0aW9uLiBBIHByb3RvdHlwZSBob2xkZXJcclxuICogdGhhdCBjb250YWlucyB0aGUgYmFzaWMgZW50cmllcy0tdXJsLCB0aXRsZSwgcXVlcnktLXdpbGwgYmUgcGFzc2VkIGluIGFzIGFcclxuICogcGFyYW1ldGVyIGluIGNhc2UgdGhpcyBpbmZvcm1hdGlvbiBpcyBuZWNlc3NhcnkgZm9yIHNwZWNpZmljIHN0b3JhZ2UuIFRoZSBzdG9yYWdlXHJcbiAqIG9mIHRoaXMgcGFydGljdWxhciBzdWdnZXN0aW9uLWJlaGF2aW9yIG11c3QgYWxzbyBmaWxsIHRoZSBcImNvbnRlbnRcIiBmaWVsZCBvZlxyXG4gKiB0aGUgc25pcHBldC4gVGhlIHByb2Nlc3NpbmcgaXMgZG9uZSBieSB0aGUgbW9kaWZpY2F0aW9uIG9mIHRoZSBwYXNzZWQgaW5cclxuICogcHJvdG90eXBlIHNuaXBwZXQsIGFzIGFmb3JlbWVudGlvbmVkLlxyXG4gKlxyXG4gKiBTdWNjZWVkaW5nIHRoaXMsIHRoZSBzdWdnZXN0aW9uIHNuaXBwZXQsIHRoZSBob2xkZXIgb2YgdGhlIHJlbGV2YW50IGluZm9ybWF0aW9uXHJcbiAqIG9mIHRoZSBwYXN0IGJlaGF2aW9yIHRvIGJlIHByb21wdGVkIGFzIGEgc3VnZ2VzdGlvbiBpbiB0aGUgb21uaWJveCBpcyBzdG9yZWRcclxuICogaW4gdGhpcyBjb250YWluZXIsIHdoaWNoIHdpbGwgbW9kaWZpZWQgZWFjaCB0aW1lIHRoZSBpbnB1dCBjaGFuZ2VzLlxyXG4gKlxyXG4gKiBBcyB0aGUgc2VsZWN0aW9uIG9mIGFueSBzdWdnZXN0aW9uLCBvciBpbiBnZW5lcmFsIHRoZSBhc2NlcnRhaW5tZW50IG9mIGFuXHJcbiAqIGlucHV0IGluIHRoZSBvbW5pYm94IG11c3Qgc3VwZXJjZWRlIHNvbWUgY2hhbmdlIGluIGlucHV0LCB3aGljaCB0cmlnZ2VycyB0aGVcclxuICogcHJvcGVyIHByb2Nlc3NpbmcgYW5kIHBvcHVsYXRpb24gb2YgdGhpcyBob2xkZXIsIGFsbCB0aGUgYmVoYXZpb3JzIHRoYXQgY2FuXHJcbiAqIGVsaWNpdCBhIHNwZWNpYWwgZGlyZWN0aW9uLCBpLmUuIHRvIGEgc3BlY2lmaWMgc2l0ZSwgaXMgcHJvcGVybHkgc3RvcmVkIGluXHJcbiAqIHRoaXMgaG9sZGVyIGJlZm9yZSBqcy9iYWNrZ3JvdW5kLmFjY2VwdElucHV0IGlzIGludm9rZWQsIHdoaWNoIGNoZWNrcyBpZlxyXG4gKiB0aGUgaW5wdXQgbWF0Y2hlcyBhbnkgc3VnZ2VzdGlvbiBpbiB0aGlzIGNvbnRhaW5lci5cclxuICovXHJcbmxldCBzdWdnZXN0aW9uSG9sZGVyO1xyXG5jaHJvbWUub21uaWJveC5vbklucHV0Q2hhbmdlZC5hZGRMaXN0ZW5lcihvbW5pYm94SGFuZGxlcik7XHJcbmNocm9tZS5vbW5pYm94Lm9uSW5wdXRFbnRlcmVkLmFkZExpc3RlbmVyKGFjY2VwdElucHV0KTtcclxuY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKGhhbmRsZU1lc3NhZ2UpO1xyXG5jaHJvbWUucnVudGltZS5vbkluc3RhbGxlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoKSB7XHJcbiAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5jbGVhcihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSBjaHJvbWUucnVudGltZS5sYXN0RXJyb3I7XHJcbiAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59KTtcclxuXHJcblxyXG4vLyBXaGVuIGEgdGFiIGp1c3QgZ290IGNyZWF0ZWQuXHJcbmNocm9tZS50YWJzLm9uQ3JlYXRlZC5hZGRMaXN0ZW5lcihmdW5jdGlvbih0YWIpe1xyXG4gICAgbGV0IHRvU2F2ZSA9IHt9O1xyXG4gICAgdG9TYXZlW3RhYi5pZC50b1N0cmluZygpXSA9IFtdO1xyXG4gICAgY29uc29sZS5sb2coXCJpbml0aWFsaXppbmcgLi4gZm9yIHRhYiBcIiArIHRhYi5pZC50b1N0cmluZygpKTtcclxuICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLnNldCh0b1NhdmUpO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBXaGVuIHRoZXJlIGlzIGEgY2hhbmdlZCB1cmwgZm9yIHNvbWUgdGFiLFxyXG4gKiAxKSBmZXRjaCB0aGUgdGhlIG9yaWdpbmFsIHF1ZXJ5IHdvcmRzIGZvciB0aGUgdXJsLCBhc3N1bWluZyB0aGUgdXJsIGlzIHJlZGlyZWN0ZWRcclxuICogZnJvbSBhIHByZXZpb3VzIHNlYXJjaCByZXN1bHQgcGFnZSBpbiB0aGUgc2FtZSB0YWJcclxuICogMikgc2F2ZSB0aGUgdXJsIHZpc2l0IHJlY29yZCAtIGlmIG5vIHZpc2l0IGluIHRoZSBwYXN0LCBjcmVhdGUgYSBlbnRyeSwgaWYgdGhlcmUgaXMsIHVwZGF0ZSB0aGUgdmlzaXQgdGltZVxyXG4gKiAzKSBzYXZlIHRoZSBxdWVyeSB0byB0aGUgcmVjb3JkLlxyXG4gKiA077yJbGV0IHRoZSBjb250ZW50IHNjcmlwdCBrbm93IHRoaXMgdXJsIGNoYW5nZSwgdG8gdXBkYXRlIFVJIChkcmF3IG1hcmtlcnMsIGhpZ2hsaWdodCB0ZXh0cywgc2Nyb2xsLCBldGMuKVxyXG4gKiA1KSBzYXZlIHRoaXMgdXJsIGhpc3RvcnkgdG8gdGFiLlxyXG4gKi9cclxuY2hyb21lLnRhYnMub25VcGRhdGVkLmFkZExpc3RlbmVyKGZ1bmN0aW9uKHRhYklkLCBjaGFuZ2VJbmZvLCB0YWIpIHtcclxuICAgIGxldCB0YWJVcmwgPSBnZXRSb290VXJsKHRhYi51cmwpO1xyXG4gICAgaWYgKGNoYW5nZUluZm8uc3RhdHVzID09PSBcImNvbXBsZXRlXCIgJiYgaXNWYWxpZFVybCh0YWJVcmwpKXtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIm5ldyB1cmwgZGV0ZWN0ZWQ6XCIgKyB0YWJVcmwgK1wiIGZvciB0YWIgXCIgKyB0YWJJZCk7XHJcbiAgICAgICAgbGV0IHF1ZXJ5ID0gbnVsbDtcclxuICAgICAgICAvL0xvb2sgdXAgdXJsIGhpc3RvcnkgZm9yIHRoZSBjdXJyZW50IHRhYi5cclxuICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQoe1t0YWJJZC50b1N0cmluZygpXTpbXX0sIGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgIGxldCBwYXN0VXJscyA9IGl0ZW1bdGFiSWQudG9TdHJpbmcoKV07XHJcbiAgICAgICAgICAgIC8vIEZldGNoIHF1ZXJ5IGZyb20gdGhlIHVybCBoaXN0b3J5IG9mIHRoZSBjdXJyZW50IHRhYlxyXG4gICAgICAgICAgICBpZiAocGFzdFVybHMubGVuZ3RoICE9PSAwKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaSA9IHBhc3RVcmxzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIC8vVHJ5IGdldCB0aGUgbW9zdCByZWNlbnQgcXVlcnkuXHJcbiAgICAgICAgICAgICAgICB3aGlsZSgtLWk+PTApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0F0dGVtcHQgdG8gZXh0cmFjdCBxdWVyeS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSBleHRyYWN0UXVlcnlGcm9tVXJsKHBhc3RVcmxzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY2F0Y2goZXhjKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9Ta2lwLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy9RdWVyeSBleHRyYWN0ZWQgbXVzdCBiZSBhIHN0cmluZy5cclxuICAgICAgICAgICAgICAgICAgICBpZihxdWVyeSAhPT0gbnVsbCAmJiB0eXBlb2YgcXVlcnkgPT09IFwic3RyaW5nXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vVXBkYXRlIHRoZSBjdXJyZW50IHVybCB0byB0aGUgdXJsJ3MgYmVoYXZpb3IgaXRlbSBtYXAsIGlmIHRoZXJlIGlzbid0XHJcbiAgICAgICAgICAgIC8vb25lIHlldCwgY3JlYXRlIGl0LlxyXG4gICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQodGFiVXJsLCBmdW5jdGlvbiAodXJsRW50cnkpIHtcclxuICAgICAgICAgICAgICAgIC8vSWYgdGhpcyB1cmwgaGFzIG5vdCBiZWVuIHByZXZpb3VzbHkgc3RvcmVkLlxyXG4gICAgICAgICAgICAgICAgLy9tZXJnZSB0aGUgYmVoYXZpb3Igb2YgdmlkZW8gYW5kIHN0YXlcclxuICAgICAgICAgICAgICAgIGlmKCF1cmxFbnRyeVt0YWJVcmxdKVxyXG4gICAgICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlVybCBvZiB0aGlzIHRhYiBoYXMgbm90IGJlZW4gcHJldmlvdXNseSBzdG9yZWQhXCIsIHVybEVudHJ5KTtcclxuICAgICAgICAgICAgICAgICAgICBzYXZlVXJsSW5mbyh0YWJVcmwsIHt2aXNpdDpbe3Zpc2l0VGltZTogbmV3IERhdGUoKSwgcXVlcnk6IHF1ZXJ5fV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0YWIudGl0bGV9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVXJsIHByZXZpb3VzbHkgdmlzaXRlZCFcIiwgdXJsRW50cnkpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vVGhlIHByZXZpb3VzIGJlaGF2aW9yYWwgaW5mb3JtYXRpb24gZ2FybmVyZWQuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJlaGF2aW9yID0gdXJsRW50cnlbdGFiVXJsXTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkJlaGF2aW9yIFwiLCBiZWhhdmlvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHZpZGVvU25pcHBldD17fTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcmlnaHRQb3NpdGlvbj1udWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChiZWhhdmlvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmVoYXZpb3JbXCJ2aWRlb19zbmlwcGV0XCJdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlb1NuaXBwZXQgPSBnZXRNb3N0VmFsdWFibGVWaWRlbyhiZWhhdmlvcltcInZpZGVvX3NuaXBwZXRcIl0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codmlkZW9TbmlwcGV0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmVoYXZpb3JbXCJzdGF5XCJdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByaWdodFBvc2l0aW9uID0gc2VsZWN0TW9zdFZhbHVhYmxlU3RheShiZWhhdmlvcltcInN0YXlcIl0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmlnaHRQb3NpdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UodGFiSWQsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiB0YWJVcmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidHlwZVwiOlwibmV3X3VybFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcInZpZGVvXCI6IHZpZGVvU25pcHBldCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJwb3NpdGlvblwiOiByaWdodFBvc2l0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9BZGQgdGhlIGN1cnJlbnQgdGltZSBhbmQgYXNzb2NpYXRlZCBxdWVyeSB0byB0aGlzIHVybC5cclxuICAgICAgICAgICAgICAgICAgICBsZXQgdmlzaXRzID0gYmVoYXZpb3JbXCJ2aXNpdFwiXTtcclxuICAgICAgICAgICAgICAgICAgICB2aXNpdHMucHVzaCh7dmlzaXRUaW1lOiBuZXcgRGF0ZSgpLCBxdWVyeTogcXVlcnl9KTtcclxuICAgICAgICAgICAgICAgICAgICBzYXZlVXJsSW5mbyh0YWJVcmwsIGJlaGF2aW9yKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy9jaHJvbWUudGFicy5zZW5kTWVzc2FnZSh0YWJJZCwge3VybDogdGFiLnVybH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7fSk7XHJcbiAgICAgICAgICAgIHBhc3RVcmxzLnB1c2godGFiVXJsKTtcclxuICAgICAgICAgICAgc2F2ZVVybHNUb1RhYihwYXN0VXJscywgdGFiSWQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBDb21wYXJlIGlmIHR3byBvYmplY3RzIGhhdmUgaWRlbnRpY2FsIGZpZWxkcyBhbmQgaWRlbnRpY2FsIGNvcnJlc3BvbmRpbmcgdmFsdWVzLlxyXG4gKiBUaGUgZmllbGQgXCJ0aW1lXCIgaXMgbm90IGNvbXBhcmVkLlxyXG4gKiBBdCBwcmVzZW50LCBjb21wYXJpbmcgdHdvIGJlaGF2aW9ycyBpcyByZXN0cmljdGVkIHRvIHRoZWlyIGFjdHVhbCBpbmZvcm1hdGlvbixcclxuICogc28gaWYgdGhlIGRpZmZlcmVuY2UgaXMgb25seSBpbiBldmVudF90eXBlLCBsaWtlIFwiY29weVwiIGFuZCBcImhpZ2hsaWdodFwiLCB3aGlsZVxyXG4gKiB0aGVpciBjb250ZW50IG9iamVjdCBpcyB0aGUgc2FtZSwgdGhlIHJlc3VsdCBvZiBjb21wYXJpc29uIHdpbGwgYmUgdHJ1ZS5cclxuICogQHBhcmFtIG9iajFcclxuICogQHBhcmFtIG9iajJcclxuICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAqL1xyXG5mdW5jdGlvbiBjb21wYXJlKG9iajEsIG9iajIpXHJcbntcclxuICAgIC8vRmllbGRzIG9mIGJvdGggb2JqZWN0c1xyXG4gICAgbGV0IGtleXMxID0gT2JqZWN0LmtleXMob2JqMSk7XHJcbiAgICBsZXQga2V5czIgPSBPYmplY3Qua2V5cyhvYmoyKTtcclxuICAgIC8vU29ydCB0aGUgYXJyYXlzIGZvciBjb21wYXJpc29uLlxyXG4gICAga2V5czEuc29ydCgpO1xyXG4gICAga2V5czIuc29ydCgpO1xyXG4gICAgY29uc29sZS5sb2coXCJrZXlzIFwiLCBrZXlzMSwga2V5czIpO1xyXG4gICAgLy9JZiB0aGUgdHdvIG9iamVjdHMgbm8gbm90IGV2ZW4gaGF2ZSB0aGUgc2FtZSBudW1iZXIgb2Yga2V5cy5cclxuICAgIGlmKGtleXMxLmxlbmd0aCAhPT0ga2V5czIubGVuZ3RoKVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIC8vQ29tcGFyZSBwZXIgZmllbGQ7IHNwYXJlIHRoZSBcInRpbWVcIiBmaWVsZC5cclxuICAgIGZvcihsZXQgaW5kZXggaW4ga2V5czEpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coa2V5czFbaW5kZXhdLCBrZXlzMltpbmRleF0sIG9iajFba2V5czFbaW5kZXhdLCBvYmoyW2tleXMyW2luZGV4XV1dKTtcclxuICAgICAgICAvL0lmIHRoZSBmaWVsZCBuYW1lIGlzIG5vdCBpZGVudGljYWwuXHJcbiAgICAgICAgaWYoa2V5czFbaW5kZXhdICE9PSBrZXlzMltpbmRleF0pXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAvL0lmIHRoZSB2YWx1ZSBpcyBub3QuIFNwYXJlIFwidGltZVwiLlxyXG4gICAgICAgIGVsc2UgaWYoa2V5czFbaW5kZXhdICE9PSBcInRpbWVcIiAmJiBvYmoxW2tleXMxW2luZGV4XV0gIT09IG9iajJba2V5czFbaW5kZXhdXSlcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBFeHRyYWN0IHF1ZXJ5IGdpdmVuIGEgdXJsXHJcbiAqIFRPRE86IHN1cHBvcnQgbW9yZSB1cmwgcGF0dGVybiB0byBleHRyYWN0IHF1ZXJpZXNcclxuICogQHBhcmFtIHVybFxyXG4gKiBAcmV0dXJucyB7Kn0gdGhlIGV4dHJhY3RlZCBxdWVyeVxyXG4gKi9cclxuZnVuY3Rpb24gZXh0cmFjdFF1ZXJ5RnJvbVVybCh1cmwpe1xyXG4gICAgaWYgKHVybC5pbmNsdWRlcyhcImdvb2dsZS5jb21cIikpIHtcclxuICAgICAgICBjb25zdCByZWdleCA9IC8oPzw9cT0pLio/KD89JikvcztcclxuICAgICAgICBpZiAodXJsLm1hdGNoKHJlZ2V4KSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdXJsLm1hdGNoKHJlZ2V4KVswXS5yZXBsYWNlKC9cXCsvZywgJyAnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZih1cmwuaW5jbHVkZXMoXCIuYW1hem9uLmNvbVwiKSl7XHJcbiAgICAgICAgY29uc3QgcmVnZXggPSAvKD88PWs9KS4qPyg/PSYpL3M7XHJcbiAgICAgICAgaWYgKHVybC5tYXRjaChyZWdleCkgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVybC5tYXRjaChyZWdleClbMF0ucmVwbGFjZSgvXFwrL2csICcgJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYodXJsLmluY2x1ZGVzKFwiLnllbHAuY29tXCIpKXtcclxuICAgICAgICBjb25zdCByZWdleCA9IC8oPzw9ZmluZF9kZXNjPSkuKj8oPz0mKS9zO1xyXG4gICAgICAgIGlmICh1cmwubWF0Y2gocmVnZXgpICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1cmwubWF0Y2gocmVnZXgpWzBdLnJlcGxhY2UoL1xcKy9nLCAnICcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKHVybC5pbmNsdWRlcyhcIi5saW5rZWRpbi5jb21cIikpe1xyXG4gICAgICAgIGNvbnN0IHJlZ2V4ID0gLyg/PD1rZXl3b3Jkcz0pLio/KD89JikvcztcclxuICAgICAgICBpZiAodXJsLm1hdGNoKHJlZ2V4KSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdXJsLm1hdGNoKHJlZ2V4KVswXS5yZXBsYWNlKC9cXCsvZywgJyAnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZih1cmwuaW5jbHVkZXMoXCIueW91dHViZS5jb21cIikpe1xyXG4gICAgICAgIGNvbnN0IHJlZ2V4ID0gL3NlYXJjaF9xdWVyeT0oLiopLztcclxuICAgICAgICBpZiAodXJsLm1hdGNoKHJlZ2V4KVsxXSE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1cmwubWF0Y2gocmVnZXgpWzFdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmKHVybC5pbmNsdWRlcyhcIi5naXRodWIuY29tXCJ8fFwiLnN0YWNrb3ZlcmZsb3cuY29tXCJ8fFwiLmJiYy5jby51a1wifHxcIi50ZWQuY29tXCIpKXtcclxuICAgICAgICBjb25zdCByZWdleCA9IC9xPSguKikvO1xyXG4gICAgICAgIGlmICh1cmwubWF0Y2gocmVnZXgpWzFdIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVybC5tYXRjaChyZWdleClbMV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYodXJsLmluY2x1ZGVzKFwiLndpa2lwZWRpYS5vcmdcIikpe1xyXG4gICAgICAgIGNvbnN0IHJlZ2V4ID0gL3dpa2lcXC8oLiopLztcclxuICAgICAgICBpZiAodXJsLm1hdGNoKHJlZ2V4KVsxXSE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1cmwubWF0Y2gocmVnZXgpWzFdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZXMgb3IgbW9kaWZpZXMgdGhlIG5hbWVzcGFjZSBmb3IgYW4gdXJsIG9mIGl0cyBjb3JyZXNwb25kaW5nIHZpc2l0XHJcbiAqIGluZm9ybWF0aW9uLCB3aGljaCBpcyBhbiBhcnJheSBvZiBvYmplY3RzIHdpdGgga2V5cyBcInZpc2l0VGltZVwiLCBhbmQgXCJxdWVyeVwiO1xyXG4gKiB0aGUgbGF0dGVyIG1heSBiZSBudWxsLiBUaGlzIG1ldGhvZCBpcyBpbnZva2VkIHdoZW4gYSB0YWIgaXMgbmV3bHkgbG9hZGVkLlxyXG4gKiBUaGUgaW5mbyBwYXJhbWV0ZXIgbXVzdCBiZSB0aGUgZW50aXJlIG1hcCBvZiBiZWhhdmlvcmFsIGluZm9ybWF0aW9uIGFzc29jaWF0ZWRcclxuICogd2l0aCB0aGlzIHVybC5cclxuICogQHBhcmFtIHVybCBUaGUgdXJsIHdob3NlIGNvcnJlc3BvbmRpbmcgYmVoYXZpb3JhbCBpbmZvcm1hdGlvbiBpcyB0byBiZSBtb2RpZmllZC5cclxuICogQHBhcmFtIGluZm8gVGhlIGVudGlyZSBtYXAgb2YgYmVoYXZpb3JhbCBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkLlxyXG4gKi9cclxuZnVuY3Rpb24gc2F2ZVVybEluZm8odXJsLCBpbmZvKVxyXG57XHJcbiAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5zZXQoe1t1cmxdOiBpbmZvfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTYXZlIGEgbGlzdCBvZiB1cmwgYXMgaGlzdG9yeSBmb3IgYSB0YWJcclxuICogVE9ETzogZGVyZWsgLSBhZGQgdmlzaXQgdGltZSBpbmZvcm1hdGlvbiBmb3IgZWFjaCB1cmwuXHJcbiAqIEBwYXJhbSB1cmxzXHJcbiAqIEBwYXJhbSB0YWJJZFxyXG4gKi9cclxuZnVuY3Rpb24gc2F2ZVVybHNUb1RhYih1cmxzLCB0YWJJZCl7XHJcbiAgICBjb25zb2xlLmxvZyhcInNhdmUgdXJscyB0byB0YWIgXCIrIHRhYklkKTtcclxuICAgIGxldCB0b1NhdmUgPSB7fTtcclxuICAgIHRvU2F2ZVt0YWJJZC50b1N0cmluZygpXSA9ICB1cmxzO1xyXG4gICAgY2hyb21lLnN0b3JhZ2UubG9jYWwuc2V0KHRvU2F2ZSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKlxyXG4gKiBAcGFyYW0gc3RyXHJcbiAqIEBwYXJhbSBjb29yZHNcclxuICogQHBhcmFtIGNhbGxiYWNrXHJcbiAqL1xyXG5mdW5jdGlvbiBjcm9wRGF0YShzdHIsIGNvb3JkcywgY2FsbGJhY2spIHtcclxuICAgIGxldCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuXHJcbiAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgICAgIGNhbnZhcy53aWR0aCA9IGNvb3Jkcy53O1xyXG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBjb29yZHMuaDtcclxuXHJcbiAgICAgICAgY2FudmFzLmdldENvbnRleHQoJzJkJykuZHJhd0ltYWdlKGltZywgY29vcmRzLngqd2luZG93LmRldmljZVBpeGVsUmF0aW8sIGNvb3Jkcy55KndpbmRvdy5kZXZpY2VQaXhlbFJhdGlvLCBjb29yZHMudyp3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbywgY29vcmRzLmgqd2luZG93LmRldmljZVBpeGVsUmF0aW8sIDAsIDAsIGNvb3Jkcy53LCBjb29yZHMuaCk7XHJcblxyXG4gICAgICAgIGNhbGxiYWNrKHtkYXRhVXJpOiBjYW52YXMudG9EYXRhVVJMKCl9KTtcclxuICAgIH07XHJcblxyXG4gICAgaW1nLnNyYyA9IHN0cjtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKlxyXG4gKiBAcGFyYW0gX3NjcmVlbnNob3RPYmpcclxuICovXHJcbmZ1bmN0aW9uIGNhcHR1cmUoX3NjcmVlbnNob3RPYmopIHtcclxuICAgIGNocm9tZS50YWJzLmNhcHR1cmVWaXNpYmxlVGFiKG51bGwsIHtmb3JtYXQ6IFwicG5nXCJ9LCBmdW5jdGlvbihkYXRhKSB7XHJcblxyXG4gICAgICAgIGNyb3BEYXRhKGRhdGEsIF9zY3JlZW5zaG90T2JqLmNvb3JkaW5hdGVzLCBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgIGRvd25sb2FkKGRhdGEuZGF0YVVyaSwgX3NjcmVlbnNob3RPYmouZmlsZW5hbWUsIFwiaW1hZ2UvcGxhaW5cIik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUsIG9yIGFkZCwgYSBiZWhhdmlvciBpdGVtIG9uIHRoZSBnaXZlbiB3ZWIgcGFnZS4gRWFjaCB1cmwgY29ycmVzcG9uZHMgd2l0aFxyXG4gKiBhIG1hcCB0aGF0IGNvbnRhaW5zIGRpZmZlcmVudCBiZWhhdmlvciBjb2RlcyBhcyBrZXlzIGFuZCBhbiBhcnJheSB0aGF0IGNvbnRhaW5zXHJcbiAqIGFsbCBiZWhhdmlvcmFsIGluZm9ybWF0aW9uIG9mIHRoaXMgdHlwZSBvZiBiZWhhdmlvci4gRm9yIGNlcnRhaW4gaW5mb3JtYXRpb24sIGFzXHJcbiAqIHRpdGxlLCB3aGljaCBkb2VzIG5vdCByZWFsbHkgYWNjb3VudCBmb3IgYSBiZWhhdmlvciB0aGF0IGNhbiBvY2N1ciBtb3JlIHRoYW4gb25jZSxcclxuICogdGhlaXIgY29ycmVzcG9uZGluZyB2YWx1ZSBtYXkgYmUgYSBzaW5nbGUgdmFsdWUuXHJcbiAqIEBwYXJhbSB1cmwgVGhlIHVybCBhc3NvY2lhdGVkIHdpdGggdGhpcyBpbmZvcm1hdGlvbi5cclxuICogQHBhcmFtIGJlaGF2aW9yVHlwZSBUaGUgdHlwZSBvZiBiZWhhdmlvciwgYXMgZGVsaW5lYXRlZCBpbiB0aGUgYmVoYXZpb3IgY29kZSBjb250YWluZXIuXHJcbiAqIEBwYXJhbSBiZWhhdmlvciBUaGUgYWN0dWFsIGJ1bmRsZSBvZiBiZWhhdmlvcmFsIGluZm9ybWF0aW9uIHRvIGJlIHN0b3JlZC5cclxuICovXHJcbmZ1bmN0aW9uIHVwZGF0ZSh1cmwsIGJlaGF2aW9yVHlwZSwgYmVoYXZpb3IpXHJcbntcclxuICAgIC8vSWYgbm8gcHJldmlvdXMgc3RvcmFnZSBvZiBiZWhhdmlvciBleGlzdHMgdW5kZXIgdGhpcyB1cmwsIHJlc3VsdCB3b3VsZCBiZSB7fS5cclxuICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLmdldCh1cmwsIGZ1bmN0aW9uIChyZXN1bHQpXHJcbiAgICB7XHJcbiAgICAgICAgLy8gSWYgdGhlcmUgYXJlIG5vIGV4aXN0aW5nIGJlaGF2aW9ycyBzdG9yZWQgeWV0IHRvIHRoaXMgdXJsLFxyXG4gICAgICAgIC8vIHByb3ZpZGUgYSBjb250YWluZXIuXHJcbiAgICAgICAgbGV0IGV4aXN0aW5nQmVoYXZpb3JzO1xyXG4gICAgICAgIGlmKCFyZXN1bHRbdXJsXSlcclxuICAgICAgICAgICAgZXhpc3RpbmdCZWhhdmlvcnMgPSB7fTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIGV4aXN0aW5nQmVoYXZpb3JzID0gcmVzdWx0W3VybF07XHJcbiAgICAgICAgLy9BbGwgcHJldmlvdXMgYmVoYXZpb3JzIG9mIHRoaXMgY2F0ZWdvcnkuXHJcbiAgICAgICAgbGV0IGJodnM7XHJcbiAgICAgICAgLy9XaGV0aGVyIHRoZSBjdXJyZW50IGJlaGF2aW9yIGlzIGEgZHVwbGljYXRlIGluIGNvbnRlbnQgb2Ygb25lIHJlY29yZGVkXHJcbiAgICAgICAgLy9iZWZvcmUuXHJcbiAgICAgICAgbGV0IGlzRHVwbGljYXRlID0gZmFsc2U7XHJcbiAgICAgICAgLy8gQXBwZW5kIHRoZSBuZXcgYmVoYXZpb3IgdG8gdGhlIGVuZCBvZiB0aGUgbGlzdCBvZiB0aGlzIHR5cGUgb2YgYmVoYXZpb3JcclxuICAgICAgICBpZighcmVzdWx0W3VybF0gfHwgIWV4aXN0aW5nQmVoYXZpb3JzW2JlaGF2aW9yVHlwZV0pXHJcbiAgICAgICAgICAgIGV4aXN0aW5nQmVoYXZpb3JzW2JlaGF2aW9yVHlwZV0gPSBbXTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBiaHZzID0gZXhpc3RpbmdCZWhhdmlvcnNbYmVoYXZpb3JUeXBlXTtcclxuICAgICAgICAgICAgLy9DaGVjayBpZiBhIGR1cGxpY2F0ZSBiZWhhdmlvciBvZiBhIGRpZmZlcmVudCBhY2Nlc3MgdGltZSBpcyBlbmNvdW50ZXJlZC5cclxuICAgICAgICAgICAgZm9yKGxldCBpbmRleCBpbiBiaHZzKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZihjb21wYXJlKGJodnNbaW5kZXhdLCBiZWhhdmlvcikpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoaXNEdXBsaWNhdGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJodnNbaW5kZXhdLnRpbWUucHVzaChiZWhhdmlvci50aW1lWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICBpc0R1cGxpY2F0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgYmh2cyA9IGV4aXN0aW5nQmVoYXZpb3JzW2JlaGF2aW9yVHlwZV07XHJcbiAgICAgICAgaWYoIWlzRHVwbGljYXRlKVxyXG4gICAgICAgIC8vQXBwZW5kIHRoaXMgYmVoYXZpb3IgYXMgbmV3IGJlaGF2aW9yIGlmIG5vbmUgd2l0aCB0aGUgc2FtZSBjb250ZW50XHJcbiAgICAgICAgLy9pcyBmb3VuZC5cclxuICAgICAgICAgICAgYmh2cy5wdXNoKGJlaGF2aW9yKTtcclxuICAgICAgICAvL1RoZSB1cmwtYXNzb2NpYXRlZCBiZWhhdmlvciByZWNvcmQuXHJcbiAgICAgICAgbGV0IHRvU2F2ZSA9IHt9O1xyXG4gICAgICAgIHRvU2F2ZVt1cmxdID0gZXhpc3RpbmdCZWhhdmlvcnM7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXhpc3RpbmdCZWhhdmlvcnMpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQmVoYXZpb3IgU3RvcmVkIFwiLCB0b1NhdmUpO1xyXG4gICAgICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLnNldCh0b1NhdmUpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZWxlY3RpbmcgYSBtb3N0IHByb2JhYmxlIHN0YXkgdXNlcnMgd291bGQgbGlrZSB0byByZXZpc2l0XHJcbiAqIFRPRE86IEBaWkwgLSBDb25zaWRlciBzdGF5IGZyZXF1ZW5jeVxyXG4gKiBAcGFyYW0gYXJyYXlcclxuICogQHJldHVybnMgeyp9XHJcbiAqL1xyXG4vL3VwZGF0ZSBjb25zaWRlciBzdGF5IGZyZXF1ZW5jeVxyXG5mdW5jdGlvbiBzZWxlY3RNYXhQb3NpdGlvbihhcnJheSl7XHJcbiAgICBsZXQgbWF4UG9zaXRpb249MDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGFycmF5Lmxlbmd0aCAtIDE7IGkrKykge1xyXG4gICAgICAgIGlmIChhcnJheVtpXS5wb3NpdGlvbiA+IG1heFBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgIG1heFBvc2l0aW9uID0gYXJyYXlbaV0ucG9zaXRpb247XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG1heFBvc2l0aW9uO1xyXG59XHJcbi8vV2luZG93IG1heGltaXphdGlvbiBhYm91dCAxMDAwIGEgcGFnZSxkaXZpZGUgYnkgNTAwIGEgcGFydFxyXG5mdW5jdGlvbiBzZWxlY3RNb3N0VmFsdWFibGVTdGF5KGFycmF5KSB7XHJcbiAgICBsZXQgc3VtRHVyYXRpb24gPSBbXTtcclxuICAgIGxldCBzdGF5UG9zaXRpb249W107XHJcbiAgICBsZXQgc2Nyb2xsVG87XHJcbiAgICBsZXQgbWF4RHVyYXRpb249MDtcclxuICAgIGxldCBrID0gTWF0aC5jZWlsKHNlbGVjdE1heFBvc2l0aW9uKGFycmF5KS8gNTAwKTtcclxuICAgIGZvciAoazsgayA+PTA7IGstLSkge1xyXG4gICAgICAgIHN1bUR1cmF0aW9uW2tdPTA7XHJcbiAgICAgICAgc3RheVBvc2l0aW9uW2tdPTA7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gYXJyYXkubGVuZ3RoIC0gMTsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChhcnJheVtpXS5wb3NpdGlvbiA+IDUwMCAqIChrIC0gMSkgJiYgYXJyYXlbaV0ucG9zaXRpb24gPD0gNTAwICogaykge1xyXG4gICAgICAgICAgICAgICAgc3VtRHVyYXRpb25ba10gPSBzdW1EdXJhdGlvbltrXSArIGFycmF5W2ldLmR1cmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgc3RheVBvc2l0aW9uW2tdID0gKGFycmF5W2ldLnBvc2l0aW9uICsgc3RheVBvc2l0aW9uW2tdKSAvIDJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvcihsZXQgaj0wO2o8PU1hdGguY2VpbChzZWxlY3RNYXhQb3NpdGlvbihhcnJheSkvIDUwMCk7aisrKXtcclxuICAgICAgICBpZihzdW1EdXJhdGlvbltqXT5tYXhEdXJhdGlvbil7XHJcbiAgICAgICAgICAgIHNjcm9sbFRvPXN0YXlQb3NpdGlvbltqXTtcclxuICAgICAgICAgICAgbWF4RHVyYXRpb249c3VtRHVyYXRpb25bal07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNjcm9sbFRvO1xyXG59XHJcbi8vdXBkYXRlIGFib3ZlXHJcblxyXG5cclxuZnVuY3Rpb24gZ2V0TW9zdFZhbHVhYmxlVmlkZW8oYXJyYXkpIHtcclxuICAgIGxldCBsb25nZXN0VGltZT0wO1xyXG4gICAgbGV0IHZhbHVhYmxlU25pcHBldDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGFycmF5Lmxlbmd0aCAtIDE7IGkrKykge1xyXG4gICAgICAgIGxldCBzbmlwcGV0PWFycmF5W2ldLmVuZF90aW1lLWFycmF5W2ldLnN0YXJ0X3RpbWU7XHJcbiAgICAgICAgaWYoc25pcHBldD5sb25nZXN0VGltZSl7XHJcbiAgICAgICAgICAgIHZhbHVhYmxlU25pcHBldD1hcnJheVtpXTtcclxuICAgICAgICAgICAgbG9uZ2VzdFRpbWU9c25pcHBldDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdmFsdWFibGVTbmlwcGV0O1xyXG59XHJcbi8vZ2V0IG1vc3QgdmFsdWFibGUgdmlkZW8gc25pcHBldCdzIHVybCBhbmQgdmFsdWUgZ2l2ZXMgdG8gdmlkZW9fdXJsXHJcbmZ1bmN0aW9uIHZhbHVhYmxlVmlkZW9VcmwodlVybCwgdmlkZW9TbmlwcGV0cylcclxue1xyXG4gICAgaWYoIXZpZGVvU25pcHBldHMpXHJcbiAgICB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJObyBWaWRlbyBTbmlwcGV0cyBhdCB0aGlzIFVybDogV3JvbmcgUGFzc2luZyFcIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IHZpZGVvU25pcHBldCA9IGdldE1vc3RWYWx1YWJsZVZpZGVvKHZpZGVvU25pcHBldHMpO1xyXG4gICAgbGV0IHVTdHJpbmcgPSAnJmZlYXR1cmU9eW91dHUuYmUmdD0nICtNYXRoLmZsb29yKHZpZGVvU25pcHBldC5zdGFydF90aW1lKTtcclxuICAgIHJldHVybiB2VXJsLmNvbmNhdCh1U3RyaW5nKTtcclxufVxyXG5cclxuXHJcblxyXG4vKipcclxuICogSGFuZGxpbmcgbWVzc2FnZXMgZnJvbSBjb250ZW50IHNjcmlwdC5cclxuICogQHBhcmFtIHJlcXVlc3RcclxuICogQHBhcmFtIHNlbmRlclxyXG4gKiBAcGFyYW0gc2VuZFJlc3BvbnNlXHJcbiAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gKi9cclxuZnVuY3Rpb24gaGFuZGxlTWVzc2FnZShyZXF1ZXN0LCBzZW5kZXIsIHNlbmRSZXNwb25zZSlcclxue1xyXG4gICAgLy9TaWZ0IHRoZSBldmVudCB0eXBlIGZyb20gdGhlIGFsbG93ZWQgbGlzdCBvZiBiZWhhdmlvcnMuXHJcbiAgICBsZXQgZXR5cGU7XHJcbiAgICAvL0tleXMgZm9yIHRoZSBtZXNzYWdlLCBvbmUgb2YgdGhlbSBiZWluZyBhIGJlaGF2aW9yIHR5cGUuXHJcbiAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKHJlcXVlc3QpO1xyXG4gICAgZm9yKGxldCBpbmRleCBpbiBrZXlzKVxyXG4gICAgICAgIGlmKGJlaGF2aW9yVHlwZXMuaW5jbHVkZXMoa2V5c1tpbmRleF0pKXtcclxuICAgICAgICAgICAgZXR5cGUgPSBrZXlzW2luZGV4XTtcclxuICAgICAgICAgICAgaWYgKGtleXNbaW5kZXhdID09PSBcInNjcmVlbnNob3RcIilcclxuICAgICAgICAgICAgICAgIGNhcHR1cmUocmVxdWVzdC5zY3JlZW5zaG90KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgLy9JbnZhbGlkIG1lc3NhZ2UgaWYgbm8gZXZlbnQgdHlwZSBpcyBnaXZlbi5cclxuICAgIGlmKCFldHlwZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJObyBFdmVudCBUeXBlcyBHaXZlbiEgXCIsIHJlcXVlc3QpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYmVoYXZpb3JUeXBlcy5pbmNsdWRlcyhldHlwZSkpIHtcclxuICAgICAgICB1cGRhdGUocmVxdWVzdC51cmwsIGV0eXBlLCByZXF1ZXN0W2V0eXBlXSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxufVxyXG5cclxuXHJcblxyXG4vKipcclxuICpcclxuICogQHBhcmFtIHR5cGVcclxuICogQHBhcmFtIGJodlxyXG4gKiBAcGFyYW0gb21uaWJveElucHV0XHJcbiAqIEByZXR1cm5zIHtTdHJpbmd9IFRoZSBzcGVjaWZpYyB0eXBlIG9mIGJlaGF2aW9yIHRoZSBpbnB1dCBtYXRjaGVzLlxyXG4gKi9cclxuZnVuY3Rpb24gYmVoYXZpb3JNYXRjaGVzSW5wdXQodHlwZSwgYmh2LCBvbW5pYm94SW5wdXQpIHtcclxuICAgIGlmKHR5cGUgPT09IFwiY29weVwiKVxyXG4gICAge1xyXG4gICAgICAgIC8vSWYgYSBjb2RlIHNlZ21lbnQgaXMgZW5jb3VudGVyZWQuXHJcbiAgICAgICAgaWYoYmh2LmlzX2NvZGUpXHJcbiAgICAgICAgICAgIGlmKGJodi50ZXh0LmluZGV4T2Yob21uaWJveElucHV0KSAhPT0gLTEpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJjb2RlXCI7XHJcbiAgICB9XHJcbiAgICBpZiAoYmh2LnRpdGxlLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhvbW5pYm94SW5wdXQudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpKSl7XHJcbiAgICAgICAgLy8gQERlcmVrOiBJIG1lcmdlIHRoZSB0aXRsZSBtYXRjaGluZyBoZXJlIHRvIHNpbXBsaWZ5IHRoZSBjb2RlLiBGb3IgZGVmYXVsdCB2YWx1ZSwgdGhlXHJcbiAgICAgICAgLy8gc3Vic2VxdWVudCBodG1sIHN1Z2dlc3Rpb24gc2hvdWxkbid0IGRvIGFueXRoaW5nIHNwZWNpYWwsIHdvdWxkIGJlIGdyZWF0IHRvIGxvYWQgdGhlIG9yaWdpbmFsIHNpdGUgbG9nby5cclxuICAgICAgICByZXR1cm4gXCJkZWZhdWx0XCI7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4vL1RoZSBzbmlwcGV0IHRoYXQgY29udGFpbnMgdGhlIHNpdGUtZ2VuZXJhbCBpbmZvcm1hdGlvbiBpcyBwYXNzZWQgaW4gYXNcclxuLy90aGUgdGhpcmQgcGFyYW1ldGVyLCB3aGljaCBpcyBtb2RpZmllZCBieSB0aGlzIG1ldGhvZC5cclxuZnVuY3Rpb24gc3RvcmVTdWdnZXN0aW9uU25pcHBldChiaHZUeXBlLCBiaHYsIHNuaXBwZXQpXHJcbntcclxuICAgIC8vVGhlIHBvcnRhYmxlIGRhdGEgY2FycmllciBmb3Igb21uaWJveCBzdWdnZXN0aW9uIHRvIGJlIHJldHVybmVkLlxyXG4gICAgbGV0IHN1Z2dlc3RCZWhhdmlvciA9IHNuaXBwZXQ7XHJcbiAgICBpZihiaHZUeXBlID09PSBcImNvcHlcIikge1xyXG4gICAgICAgIGlmKGJodi5pc19jb2RlKSB7XHJcbiAgICAgICAgICAgIC8vU3RvcmUgdGhlIGJlaGF2aW9yLXNwZWNpZmljIGZpZWxkcy5cclxuICAgICAgICAgICAgc3VnZ2VzdEJlaGF2aW9yW1wiY29udGVudFwiXSA9IGJodi50ZXh0O1xyXG4gICAgICAgICAgICBzdWdnZXN0QmVoYXZpb3JbXCJ0eXBlXCJdID0gXCJjb2RlXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZWxzZSBpZihiaHZUeXBlID09PSBcInZpZGVvX3NuaXBwZXRcIikge1xyXG4gICAgICAgIHN1Z2dlc3RCZWhhdmlvcltcImNvbnRlbnRcIl0gPSBzdWdnZXN0QmVoYXZpb3JbXCJ0aXRsZVwiXTtcclxuICAgICAgICBzdWdnZXN0QmVoYXZpb3JbXCJ0eXBlXCJdID0gXCJ2aWRlb19zbmlwcGV0XCI7XHJcbiAgICAgICAgc3VnZ2VzdEJlaGF2aW9yW1widXJsXCJdID0gYmh2O1xyXG4gICAgfVxyXG4gICAgLy9BZGQgY29tbW9uIHF1YW50aXRpZXMgYXMgc2VjdGlvbl9pZCB0byB0aGUgc3VnZ2VzdGlvbiBjYXJyaWVyLlxyXG4gICAgLy9UaGVzZSBhcmUgY29uZmluZWQgdG8gdGhvc2UgY29udGFpbmVkIGluIHRoZSBiZWhhdmlvciBpdHNlbGYsIG5vdCB0aGUgdXJsLFxyXG4gICAgLy90aXRsZSwgb3IgcXVlcnksIHdoaWNoIG11c3QgYmUgYXBwZW5kZWQgaW4gYmFja2dyb3VuZC5vbW5pYm94SGFuZGxlci5cclxuICAgIHN1Z2dlc3RCZWhhdmlvcltcInNlY3Rpb25faWRcIl0gPSBiaHYuc2VjdGlvbl9pZDtcclxufVxyXG5cclxuZnVuY3Rpb24gbWFrZVN1Z2dlc3Rpb25IVE1MKHN1Z2dlc3QpXHJcbntcclxuICAgIGNvbnNvbGUubG9nKFwiU3VnZ2VzdGlvbiBIb2xkZXJcIiwgc3VnZ2VzdGlvbkhvbGRlcik7XHJcblxyXG4gICAgbGV0IHN1Z2dlc3Rpb25zID0gW107XHJcbiAgICBmb3IobGV0IGk9MDsgaTxzdWdnZXN0aW9uSG9sZGVyLmxlbmd0aDsgaSsrKSB7XHJcblxyXG4gICAgICAgIGxldCBzdWdnZXN0aW9uID0gc3VnZ2VzdGlvbkhvbGRlcltpXTtcclxuICAgICAgICBsZXQgZm9ybWF0dGVkU3VnZ2VzdGlvbjtcclxuICAgICAgICBpZihzdWdnZXN0aW9uLnR5cGUgPT09IFwiY29kZVwiKVxyXG4gICAgICAgICAgICBmb3JtYXR0ZWRTdWdnZXN0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgY29udGVudDogc3VnZ2VzdGlvbi5jb250ZW50LFxyXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IChzdWdnZXN0aW9uLnF1ZXJ5Lmxlbmd0aD09PTA/XCJcIjpcclxuICAgICAgICAgICAgICAgICAgICBzdWdnZXN0aW9uLnF1ZXJ5LnRvU3RyaW5nKCkgKyBcIjogXCIpICsgc3VnZ2VzdGlvbi5jb250ZW50XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgZWxzZSBpZihzdWdnZXN0aW9uLnR5cGUgPT09IFwidmlkZW9fc25pcHBldFwiKVxyXG4gICAgICAgICAgICBmb3JtYXR0ZWRTdWdnZXN0aW9uID1cclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBzdWdnZXN0aW9uLmNvbnRlbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IChzdWdnZXN0aW9uLnF1ZXJ5Lmxlbmd0aD09PTA/XCJcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGlvbi5xdWVyeS50b1N0cmluZygpICsgXCI6IFwiKSArIHN1Z2dlc3Rpb24uY29udGVudFxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy9DaGVjayBpZiB4bWwgc3BlY2lmaWMgc3RyaW5ncyBhcmUgZW5jb3VudGVyZWQgaW4gdGhlIGRlc2NyaXB0aW9uLlxyXG4gICAgICAgIGZvcihsZXQgeG1sQ2hhciBpbiB4bWxDaGFycylcclxuICAgICAgICAgICAgaWYoZm9ybWF0dGVkU3VnZ2VzdGlvbi5kZXNjcmlwdGlvbi5pbmRleE9mKHhtbENoYXIpICE9PSAtMSlcclxuICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN1Z2dlc3Rpb24uZGVzY3JpcHRpb24gPVxyXG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZFN1Z2dlc3Rpb24uZGVzY3JpcHRpb24uc3BsaXQoeG1sQ2hhcikuam9pbih4bWxDaGFyc1t4bWxDaGFyXSk7XHJcblxyXG4gICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goZm9ybWF0dGVkU3VnZ2VzdGlvbik7XHJcbiAgICB9XHJcbiAgICBzdWdnZXN0KHN1Z2dlc3Rpb25zKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEhhbmRsaW5nIHRleHQgaW5wdXRzIGZyb20gdGhlIG9tbmlib3ggYW5kIGdlbmVyYXRlIHN1Z2dlc3Rpb25zXHJcbiAqXHJcbiAqIEZvciB0aG9zZSB0eXBlcyBvZiBiZWhhdmlvcnMgdGhhdCBoYXZlIG5vIGRldGFpbGVkIGNvbnRlbnQgZm9yIG1hdGNoaW5nLCBvdGhlclxyXG4gKiB0aGFuIHRoZSBnZW5lcmFsIHRpdGxlIGFuZCB0aGUgcGFzdCBxdWVyaWVzIG9mIHRoZSBzaXRlLCB0aGVpciBjaGVja2luZyBwYXJ0XHJcbiAqIG1heSBiZSBmb3JlZ29uZSBpbiB0aGUgYmFja2dyb3VuZC5iZWhhdmlvck1hdGNoZXNJbnB1dCBtZXRob2QsIGJ1dCBzaG91bGRcclxuICogaW5zdGVhZCBiZSByZWNvcmRlZCBpbiB0aGUgYmFja2dyb3VuZC5zdG9yZVN1Z2dlc3Rpb25TbmlwcGV0IG1ldGhvZC5cclxuICogQHBhcmFtIG9tbmlib3hUZXh0IFRoZSBjdXJyZW50IHRleHQgdHlwZWQgYnkgdGhlIHVzZXIgaW4gdGhlIG9tbmlib3guXHJcbiAqIEBwYXJhbSBzdWdnZXN0IEEgZnVuY3Rpb24gZm9yIHBvcHVsYXRpbmcgc3VnZ2VzdGlvbnMuXHJcbiAqL1xyXG5cclxuZnVuY3Rpb24gb21uaWJveEhhbmRsZXIob21uaWJveFRleHQsIHN1Z2dlc3QpXHJcbntcclxuICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLmdldChudWxsLFxyXG4gICAgICAgIC8vQWxsIHRoZSBiZWhhdmlvcnMgb3JnYW5pemVkIGJ5IHRoZWlyIHVybHMgYXMga2V5cy5cclxuICAgICAgICBmdW5jdGlvbiAoYmh2SXRlbXMpIHtcclxuICAgICAgICAgICAgLy9BIGhvbGRlciBmb3IgYW55IGtpbmQgb2YgcHJldmlvdXMgYmVoYXZpb3IgdGhhdCBtYXkgcHJvbXB0IGEgdXNlZnVsXHJcbiAgICAgICAgICAgIC8vc3VnZ2VzdGlvbi5cclxuICAgICAgICAgICAgc3VnZ2VzdGlvbkhvbGRlciA9IFtdO1xyXG4gICAgICAgICAgICAvL0xvb3AgdGhyb3VnaCBlYWNoIHVybCBhbmQgZXhhbWluZSBpZiBhbnkgb2YgaXRzIGJlaGF2aW9ycyBtYXRjaGVzIHRoZVxyXG4gICAgICAgICAgICAvL2lucHV0IGdpdmVuIHByZXNlbnRseSBpbiB0aGUgb21uaWJveCBieSB0aGUgdXNlci5cclxuICAgICAgICAgICAgZm9yIChsZXQgdXJsIGluIGJodkl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImhleTpcIiArIHVybCk7XHJcbiAgICAgICAgICAgICAgICAvL0JlaGF2aW9ycyBjb250YWluZWQgdW5kZXIgdGhpcyB1cmwuIEFsbCBiZWhhdmlvcnMgd2lzaGVkIHRvIGJlXHJcbiAgICAgICAgICAgICAgICAvL3Byb2Nlc3NlZCB0byBwcm9tcHQgYSBzdWdnZXN0aW9uIGluZGl2aWR1YWxseSBzaG91bGQgYmVcclxuICAgICAgICAgICAgICAgIC8vaW5jbHVkZWQgaW4gdGhpcyBjb250YWluZXIuXHJcbiAgICAgICAgICAgICAgICBsZXQgYmh2cyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgbGV0IGJodkl0bSA9IGJodkl0ZW1zW3VybF07XHJcbiAgICAgICAgICAgICAgICAvL1RoZSBwcmV2aW91c2x5IGNvcGllZCBpbmZvcm1hdGlvbiBmcm9tIHRoaXMgcGFnZS5cclxuICAgICAgICAgICAgICAgIGlmIChiaHZJdG0uY29weSlcclxuICAgICAgICAgICAgICAgICAgICBiaHZzW1wiY29weVwiXSA9IGJodkl0bS5jb3B5O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKGJodkl0bS52aWRlb19zbmlwcGV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ2aWRlbyBzbmlwcGV0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHZhbHVhYmxlVmlkZW9VcmwodXJsLCBiaHZJdG0udmlkZW9fc25pcHBldCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vU2VsZWN0IHRoZSB2aWRlbyBzbmlwcGV0IHRvIGRpcmVjdCB1bnRvLlxyXG4gICAgICAgICAgICAgICAgICAgIGJodnNbXCJ2aWRlb19zbmlwcGV0XCJdID0gKHt1cmw6IHZhbHVhYmxlVmlkZW9VcmwodXJsLCBiaHZJdG0udmlkZW9fc25pcHBldCl9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvL0V4dHJhY3QgdGhlIHF1ZXJpZXMgYW5kIHRpdGxlIHRoYXQgbWF5IGJlIHVzZWQgZm9yIG1hdGNoaW5nLlxyXG4gICAgICAgICAgICAgICAgLy9BIGxpc3Qgb2YgYXNzb2NpYXRlZCBxdWVyeSBmb3IgdGhpcyBjb2RlIHNuaXBwZXQuIFRoZSBxdWVyaWVzXHJcbiAgICAgICAgICAgICAgICAvL2luIHRoaXMgYXJyYXkgbXVzdCBtYXRjaCB0aGUgY3VycmVudCBvbW5pYm94IGlucHV0LlxyXG4gICAgICAgICAgICAgICAgbGV0IHF1ZXJpZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIC8vQ2hlY2sgaWYgdGhpcyB1cmwsIGFuZCBoZW5jZSB0aGlzIGJlaGF2aW9yLCBpc1xyXG4gICAgICAgICAgICAgICAgLy9hc3NvY2lhdGVkIHdpdGggYSBxdWVyeS5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGlkeCBpbiBiaHZJdG0udmlzaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdmlzaXQgPSBiaHZJdG0udmlzaXRbaWR4XTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmlzaXRbXCJxdWVyeVwiXSAhPT0gbnVsbCAmJiBxdWVyeS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMob21uaWJveFRleHQudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgcXVlcmllcy5wdXNoKHZpc2l0W1wicXVlcnlcIl0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBlYWNoX3R5cGUgaW4gYmh2cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBiZWhhdmlvcnMgPSBiaHZzW2VhY2hfdHlwZV07XHJcbiAgICAgICAgICAgICAgICAgICAgLy9EZXRlcm1pbmUgZm9yIGVhY2ggYmVoYXZpb3Igb2YgdGhpcyB0eXBlIGlmIGl0IG1hdGNoZXNcclxuICAgICAgICAgICAgICAgICAgICAvL3RoZSBjdXJyZW50IGlucHV0IGdpdmVuIGJ5IHRoZSB1c2VyLlxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGJodkluZGV4IGluIGJlaGF2aW9ycykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYmh2ID0gYmVoYXZpb3JzW2JodkluZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9UaGUgc3BlY2lmaWMgdHlwZSBvZiBiZWhhdmlvciB0aGUgaW5wdXQgdHJpZ2dlcnMuIFRoaXNcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9tYXkgbW9kaWZ5IHRoZSBiZWhhdmlvciB0eXBlIHN0b3JlZCB0byBvbmUgbW9yZSBzcGVjaWZpYyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9saWtlIGNvcHkgdG8gY29kZS5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGJlaGF2aW9yTWF0Y2hlc0lucHV0KGVhY2hfdHlwZSwgYmh2LCBvbW5pYm94VGV4dClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IHF1ZXJpZXMubGVuZ3RoICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlJlYWR5IHRvIFN0b3JlIVwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc25pcHBldCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCI6IGJodkl0bS50aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInVybFwiOiB1cmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJxdWVyeVwiOiBxdWVyaWVzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vU3RvcmUgdGhpcyBiZWhhdmlvciBhY2NvcmRpbmdseS4gRmlyc3Qgc3BlY2lmaWNhbGx5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy90aGVuIGFkZCB0aGUgY29tbW9uIGF0dHJpYnV0ZXMuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9yZVN1Z2dlc3Rpb25TbmlwcGV0KGVhY2hfdHlwZSwgYmh2LCBzbmlwcGV0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0FkZCB0aGlzIHNuaXBwZXQgZm9yIHN1Z2dlc3Rpb24uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWdnZXN0aW9uSG9sZGVyLnB1c2goc25pcHBldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1ha2VTdWdnZXN0aW9uSFRNTChzdWdnZXN0KTtcclxuICAgICAgICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqXHJcbiAqIEBwYXJhbSB0ZXh0XHJcbiAqIEBwYXJhbSBkaXNwb3NpdGlvblxyXG4gKi9cclxuZnVuY3Rpb24gYWNjZXB0SW5wdXQodGV4dCwgZGlzcG9zaXRpb24pIHtcclxuICAgIC8vIGRpc3Bvc2l0aW9uOiBcImN1cnJlbnRUYWJcIiwgXCJuZXdGb3JlZ3JvdW5kVGFiXCIsIG9yIFwibmV3QmFja2dyb3VuZFRhYlwiXHJcbiAgICAvL0lmIHByZXZpb3VzbHkgZXh0cmFjdGVkIGNvZGUgc2VnbWVudHMgbWF0Y2ggdGhlIGN1cnJlbnQgdGV4dCwgZGlyZWN0IHRvIHRoZW0uXHJcbiAgICBpZiAoIWlzVmFsaWRVcmwodGV4dCkgJiYgIXN1Z2dlc3Rpb25Ib2xkZXIpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBzd2l0Y2ggKGRpc3Bvc2l0aW9uKSB7XHJcbiAgICAgICAgY2FzZSBcImN1cnJlbnRUYWJcIjoge1xyXG4gICAgICAgICAgICAvL0RlZmF1bHQgbGluayB1c2luZyB0ZXh0LlxyXG4gICAgICAgICAgICBsZXQgbGluayA9IHRleHQ7XHJcblxyXG4gICAgICAgICAgICBmb3IobGV0IGluZGV4IGluIHN1Z2dlc3Rpb25Ib2xkZXIpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIC8vU25pcHBldCBvZiB0aXRsZS1idW5kbGVkIGNvcGllZCBiZWhhdmlvci5cclxuICAgICAgICAgICAgICAgIGxldCBzbmlwcGV0ID0gc3VnZ2VzdGlvbkhvbGRlcltpbmRleF07XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzbmlwcGV0KTtcclxuICAgICAgICAgICAgICAgIGlmKHNuaXBwZXQuY29udGVudC50cmltKCkgPT09IHRleHQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGluayA9IHNuaXBwZXQudXJsO1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmsgPSBzbmlwcGV0LnVybC5jb25jYXQoc25pcHBldC5zZWN0aW9uX2lkP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAoXCIjXCIrc25pcHBldC5zZWN0aW9uX2lkKTpcIlwiKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImxpbmsgXCIsIGxpbmspO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNocm9tZS50YWJzLnVwZGF0ZSh7dXJsOiBsaW5rfSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlIFwibmV3Rm9yZWdyb3VuZFRhYlwiOiB7XHJcbiAgICAgICAgICAgIGNocm9tZS50YWJzLmNyZWF0ZSh7dXJsOiB0ZXh0fSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlIFwibmV3QmFja2dyb3VuZFRhYlwiOiB7XHJcbiAgICAgICAgICAgIGNocm9tZS50YWJzLmNyZWF0ZSh7dXJsOiB0ZXh0LCBhY3RpdmU6IGZhbHNlfSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/js/background.js\n");

/***/ })

})